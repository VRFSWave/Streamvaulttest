<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Watch Stream</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="header">üì∫ Now Watching</div>
  <div id="stream-container" class="stream-container">Loading stream...</div>
  <script>
    async function loadStream() {
      const params = new URLSearchParams(window.location.search);
      const id = params.get("id");
      const source = params.get("source");

      if (!id || !source) {
        document.getElementById("stream-container").innerText = "Invalid stream link.";
        console.error("Missing ID or source in URL");
        return;
      }

      const apiUrl = `https://api.streamed.su/api/stream/${source}/${id}`;
      const proxyUrl = "https://corsproxy.io/?" + encodeURIComponent(apiUrl);

      console.log("Fetching stream from:", proxyUrl);

      try {
        const res = await fetch(proxyUrl);
        if (!res.ok) throw new Error(`HTTP error! status: ${res.status}`);
        const data = await res.json();
        console.log("Stream data:", data);

        document.getElementById("stream-container").innerHTML = `
          <iframe src="${data.embedUrl}" frameborder="0" allowfullscreen></iframe>
        `;
      } catch (err) {
        console.error("Failed to load stream:", err);
        document.getElementById("stream-container").innerText =
          "‚ö†Ô∏è Failed to load stream. Check console for details.";
      }
    }

    loadStream();
  </script>
</body>
</html>
